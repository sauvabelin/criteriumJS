(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["gestion-poste"],{"2f21":function(t,e,n){"use strict";var r=n("79e5");t.exports=function(t,e){return!!t&&r(function(){e?t.call(null,function(){},1):t.call(null)})}},"35ac":function(t,e,n){},"386d":function(t,e,n){"use strict";var r=n("cb7c"),a=n("83a1"),s=n("5f1b");n("214f")("search",1,function(t,e,n,i){return[function(n){var r=t(this),a=void 0==n?void 0:n[e];return void 0!==a?a.call(n,r):new RegExp(n)[e](String(r))},function(t){var e=i(n,t,this);if(e.done)return e.value;var o=r(t),u=String(this),c=o.lastIndex;a(c,0)||(o.lastIndex=0);var l=s(o,u);return a(o.lastIndex,c)||(o.lastIndex=c),null===l?-1:l.index}]})},"52c4":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.poste?n("div",{staticClass:"p-3"},[n("set-property",{attrs:{property:"coefficient",show:t.modalCoeff,item:t.poste},on:{close:function(e){t.modalCoeff=!1}}}),n("set-property",{attrs:{property:"max",show:t.modalMax,item:t.poste},on:{close:function(e){t.modalMax=!1}}}),n("div",{staticClass:"d-flex justify-content-between align-items-center"},[n("div",[n("h1",[t._v(t._s(t.poste.nom))]),n("h2",[t._v("Gestion de poste")])]),n("div",[n("a-button",{staticClass:"mr-2",attrs:{type:"dashed"},on:{click:function(e){t.modalCoeff=!0}}},[t._v("Changer le coefficient")]),n("a-button",{attrs:{type:"dashed"},on:{click:function(e){t.modalMax=!0}}},[t._v("Changer le max de points")])],1)]),n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 col-md-4"},[n("h3",[t._v("Ecrire les points d'un participant")]),n("a-form",{attrs:{form:t.form,layout:"vertical"},on:{submit:t.submit}},[n("a-form-item",{attrs:{label:"Dossard"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["dossard",{rules:[{required:!0}]}],expression:"['dossard', {rules: [{required: true}]}]"}],attrs:{placeholder:"Dossard"}})],1),n("a-form-item",{attrs:{label:"Points"}},[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["points",{rules:[{required:!0},{validator:function(e,n,r){n>t.poste.getMax()?r("Trop grand, max: "+t.poste.max):r()}}]}],expression:"['points', {rules: [\n                        {required: true},\n                        {validator: (a,v,c) => {if(v > poste.getMax()) {c('Trop grand, max: ' + poste.max)} else c()}}\n                        ]}]"}],ref:"pref",attrs:{type:"number",placeholder:"Points réalisés au poste"}})],1),n("a-button",{attrs:{"html-type":"submit",type:"primary"}},[t._v("Valider")])],1)],1),n("div",{staticClass:"col-12 col-md-8"},[n("h3",[t._v("Résultats à ce poste")]),n("participants-liste",{attrs:{data:t.resultats,border:!0,columns:[{title:"Points",dataIndex:"points"}]}})],1)])],1):t._e(),t._m(0),n("participants-liste",{attrs:{data:t.notParticipated}})],1)},a=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p-3"},[n("h2",[t._v("Participants n'ayant pas de points entrés pour ce poste")])])}],s=(n("96cf"),n("3b8d")),i=(n("c721"),n("3af3")),o=(n("e1f5"),n("5efb")),u=(n("a71a"),n("b558")),c=n("4b2f"),l=n("9e13"),d=n("aad2"),p={components:{aInput:u["a"],aButton:o["a"],aForm:i["a"],aFormItem:i["a"].Item,ParticipantsListe:l["a"],SetProperty:d["a"]},mounted:function(){this.refresh()},computed:{poste:function(){return this.$store.getters.getPoste(this.$route.params.id)}},watch:{$route:function(){this.refresh()}},methods:{refresh:function(){var t=this;setTimeout(function(){t.poste.participantsPasEntres().then(function(e){t.notParticipated=e,t.poste.getResultats().then(function(e){t.resultats=e})})},200)},submit:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(e){var n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e.preventDefault(),t.next=3,this.form.validateFields(function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(e,r){var a,s,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(a=r.points,s=r.dossard,e){t.next=14;break}return t.next=4,c["a"].findOneBy({dossard:parseInt(s,10)});case 4:if(i=t.sent,null!==i){t.next=9;break}n.$toasted.error("Participant avec dossard ".concat(s," introuvable")),t.next=12;break;case 9:return t.next=11,i.setPosteData(n.poste.id,a);case 11:n.$toasted.success("Participant #".concat(s," a fait ").concat(a," points au poste ").concat(n.poste.nom));case 12:n.form.setFieldsValue({points:null,dossard:null}),n.$nextTick(function(){n.refresh(),n.$refs.pref.$el.focus()});case 14:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}());case 3:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}()},data:function(){return{form:this.$form.createForm(this),notParticipated:[],resultats:[],modalCoeff:!1,modalMax:!1}}},f=p,v=n("2877"),m=Object(v["a"])(f,r,a,!1,null,null,null);e["default"]=m.exports},"55dd":function(t,e,n){"use strict";var r=n("5ca1"),a=n("d8e8"),s=n("4bf8"),i=n("79e5"),o=[].sort,u=[1,2,3];r(r.P+r.F*(i(function(){u.sort(void 0)})||!i(function(){u.sort(null)})||!n("2f21")(o)),"Array",{sort:function(t){return void 0===t?o.call(s(this)):o.call(s(this),a(t))}})},"7bc5":function(t,e,n){"use strict";var r=n("c11f"),a=n.n(r);a.a},"83a1":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"9e13":function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"container-fluid"},[n("div",{staticClass:"row mb-3"},[n("div",{staticClass:"col-12 col-md-2"},[t._v("\n                Filtrer par année\n                "),n("a-select",{staticStyle:{width:"100%"},model:{value:t.year,callback:function(e){t.year=e},expression:"year"}},[n("a-select-option",{attrs:{value:-1}},[t._v("Ne pas filtrer")]),t._l(t.annees,function(e){return n("a-select-option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})],2)],1),n("div",{staticClass:"col-12 col-md-2"},[t._v("\n                Filtrer par unité\n                "),n("a-select",{staticStyle:{width:"100%"},model:{value:t.unit,callback:function(e){t.unit=e},expression:"unit"}},[n("a-select-option",{attrs:{value:-1}},[t._v("Ne pas filtrer")]),t._l(t.unites,function(e){return n("a-select-option",{key:e,attrs:{value:e}},[t._v(t._s(t.getUnite(e).nom))])})],2)],1),n("div",{staticClass:"col-12 col-md-2"},[t._v("\n                Filtrer par sous-unité\n                "),n("a-select",{staticStyle:{width:"100%"},model:{value:t.subUnit,callback:function(e){t.subUnit=e},expression:"subUnit"}},[n("a-select-option",{attrs:{value:-1}},[t._v("Ne pas filtrer")]),t._l(t.sousUnite,function(e){return n("a-select-option",{key:e,attrs:{value:e}},[t._v(t._s(t.getSousUnite(e).nom))])})],2)],1),n("div",{staticClass:"col-12 col-md-2"},[t._v("\n                Filtrer par branche\n                "),n("a-select",{staticStyle:{width:"100%"},model:{value:t.branche,callback:function(e){t.branche=e},expression:"branche"}},[n("a-select-option",{attrs:{value:-1}},[t._v("Ne pas filtrer")]),t._l(t.branches,function(e){return n("a-select-option",{key:e.nom,attrs:{value:e.bid}},[t._v(t._s(e.nom))])}),n("a-select-option",{attrs:{value:10}},[t._v("éclaireurs-euses")]),n("a-select-option",{attrs:{value:11}},[t._v("louveteaux-ettes")])],2)],1),n("div",{staticClass:"col-12 col-md-2"},[t._v("\n                Filtrer par sexe\n                "),n("a-select",{staticStyle:{width:"100%"},model:{value:t.xxx,callback:function(e){t.xxx=e},expression:"xxx"}},[n("a-select-option",{attrs:{value:-1}},[t._v("Ne pas filtrer")]),t._l(t.sexe,function(e){return n("a-select-option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})],2)],1),n("div",{staticClass:"col-12 col-md-2"},[t._v("\n                Rechercher\n                "),n("a-input",{attrs:{placeholder:"Rechercher"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)])]),n("div",{class:{bordered:t.border}},[n("a-table",{attrs:{dataSource:t.participants,columns:t.cls,rowKey:"dossard",scroll:t.scroll},scopedSlots:t._u([{key:"moment",fn:function(e){return n("span",{},[t._v("("+t._s(e)+")")])}},{key:"unite",fn:function(e){return n("div",{},[t._v(t._s(e.unite().nom))])}},{key:"sousunite",fn:function(e){return n("div",{},[t._v(t._s(e.sousUnite().nom))])}},{key:"expandedRowRender",fn:function(e){return t.details?n("div",{},[n("participant-details",{attrs:{participant:e}})],1):t._e()}}],null,!0)})],1)])},a=[],s=(n("386d"),n("6762"),n("2fdb"),n("55dd"),n("02cf"),n("9839")),i=(n("a71a"),n("b558")),o=(n("0723"),n("0020")),u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 col-md-6"},[n("h3",[t._v("Résultats aux courses")]),n("table",{staticStyle:{width:"100%",background:"transparent"}},[t._m(0),t._l(t.$store.state.courses,function(e){return n("tr",{key:e.id},[n("td",[n("b",[t._v(t._s(e.nom))])]),t.crs(e.id)?n("td",[t._v(t._s(t._f("printDate")(t.crs(e.id).debut)))]):n("td",[t._v("-")]),t.crs(e.id)?n("td",[t._v(t._s(t._f("printDate")(t.crs(e.id).arrivee)))]):n("td",[t._v("-")]),n("td",[t._v(t._s(t._f("timeDiff")([t.crs(e.id).arrivee,t.crs(e.id).debut])))])])})],2)]),n("div",{staticClass:"col-12 col-md-6"},[n("h3",[t._v("Résultats aux postes")]),n("table",{staticStyle:{width:"100%",background:"transparent"}},[t._m(1),t._l(t.$store.state.postes,function(e){return n("tr",{key:e.id},[n("td",[n("b",[t._v(t._s(e.nom))])]),n("td",[t._v(t._s(t.pst(e.id)?t.pst(e.id).points:"Rien"))])])})],2)])])])},c=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("tr",[n("th",[t._v("Course")]),n("th",[t._v("Départ")]),n("th",[t._v("Arrivée")]),n("th",[t._v("Temps total")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("tr",[n("th",[t._v("Poste")]),n("th",[t._v("Nombre de points")])])}],l=(n("7514"),n("96cf"),n("3b8d")),d={props:["participant"],mounted:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.participant.getPostesData();case 2:return this.postes=t.sent,t.next=5,this.participant.getCoursesData();case 5:this.courses=t.sent;case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),data:function(){return{postes:[],courses:[]}},methods:{tempsTotal:function(t){var e=this.crs(t);return null===e||null===e.debut||null===e.arrivee?null:e.arrivee-e.debut},pst:function(t){var e=this.postes.find(function(e){return e.posteId===t});return void 0===e||null===e?{points:null}:e},crs:function(t){var e=this.courses.find(function(e){return e.courseId===t});return void 0===e||null===e?{debut:null,arrivee:null}:e}}},p=d,f=(n("b9f2"),n("2877")),v=Object(f["a"])(p,u,c,!1,null,"75f3aae4",null),m=v.exports,h=n("514e"),b={components:{aTable:o["a"],aInput:i["a"],ParticipantDetails:m,aSelect:s["b"],aSelectOption:s["b"].Option},methods:{getUnite:function(t){return Object(h["d"])(t)},getSousUnite:function(t){return Object(h["c"])(t)}},computed:{annees:function(){var t=this.data.map(function(t){return t.naissance});return t.filter(function(e,n){return t.indexOf(e)===n}).sort(function(t,e){return parseInt(t,10)<parseInt(e,10)})},branches:function(){return h["b"]},unites:function(){var t=this,e=this.sousUnite.map(function(e){return t.getSousUnite(e).uid});return e.filter(function(t,n){return e.indexOf(t)===n}).sort(function(t,e){return parseInt(t,10)<parseInt(e,10)})},sousUnite:function(){var t=this.data.map(function(t){return t.unitId});return t.filter(function(e,n){return t.indexOf(e)===n}).sort(function(t,e){return parseInt(t,10)<parseInt(e,10)})},sexe:function(){var t=this,e=this.unites.map(function(e){return t.getUnite(e).sexe});return e.filter(function(t,n){return e.indexOf(t)===n}).sort(function(t,e){return parseInt(t,10)<parseInt(e,10)})},participants:function(){var t=this,e=this.data;return-1!==this.year&&(e=e.filter(function(e){return e.naissance===t.year})),-1!==this.subUnit&&(e=e.filter(function(e){return e.unitId===t.subUnit})),-1!==this.unit&&(e=e.filter(function(e){return t.getSousUnite(e.unitId).uid===t.unit})),-1!==this.xxx&&(e=e.filter(function(e){return t.getUnite(t.getSousUnite(e.unitId).uid).sexe===t.xxx})),-1!==this.branche&&(e=e.filter(function(e){return 10===t.branche?[1,2].includes(t.getUnite(t.getSousUnite(e.unitId).uid).bid):11===t.branche?[3,4].includes(t.getUnite(t.getSousUnite(e.unitId).uid).bid):t.getUnite(t.getSousUnite(e.unitId).uid).bid===t.branche})),this.search.length>0&&(e=e.filter(function(e){return e.prenom.toLowerCase().includes(t.search)||e.nom.toLowerCase().includes(t.search)||"".concat(e.dossard).includes(t.search)})),e},cls:function(){return[{title:"Dossard",dataIndex:"dossard",key:"dossard"},{title:"Nom",dataIndex:"nom",key:"nom"},{title:"Prénom",dataIndex:"prenom",key:"prenom"},{title:"Année",dataIndex:"naissance",key:"naissance"},{title:"Unité",dataIndex:null,scopedSlots:{customRender:"unite"}},{title:"Sous-Unité",dataIndex:null,scopedSlots:{customRender:"sousunite"}}].concat(this.columns)}},props:{data:{type:Array,required:!0},details:{type:Boolean,default:function(){return!0}},border:{type:Boolean,default:function(){return!0}},columns:{type:Array,default:function(){return[]}},scroll:{default:function(){return{}}}},data:function(){return{year:-1,subUnit:-1,unit:-1,xxx:-1,branche:-1,search:""}}},_=b,x=(n("7bc5"),Object(f["a"])(_,r,a,!1,null,"435896f6",null));e["a"]=x.exports},aad2:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("a-modal",{attrs:{visible:t.show,title:"Changer la valeur de "+t.property},on:{ok:t.handleOk,cancel:function(e){return t.$emit("close")}}},[n("a-input",{attrs:{placeholder:t.property},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1)],1)},a=[],s=(n("96cf"),n("3b8d")),i=(n("a71a"),n("b558")),o=(n("04f3"),n("ed3b")),u={components:{aModal:o["a"],aInput:i["a"]},props:["show","item","property"],mounted:function(){this.value=this.item[this.property]},data:function(){return{value:null}},methods:{handleOk:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=parseInt(this.value,10),t.next=3,this.item.update(this.property,e);case 3:this.$emit("close");case 4:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()}},c=u,l=n("2877"),d=Object(l["a"])(c,r,a,!1,null,null,null);e["a"]=d.exports},b9f2:function(t,e,n){"use strict";var r=n("35ac"),a=n.n(r);a.a},c11f:function(t,e,n){}}]);
//# sourceMappingURL=gestion-poste.656a4331.js.map